<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduNexa | Welcome</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      :root {
        --primary: #606060;
        --primary-dark: rgba(255, 100, 80, 0.575);
        --secondary: rgba(10, 6, 207, 0.322);
        --accent: rgba(10, 6, 207, 0.322);
        --success: rgba(10, 6, 207, 0.322);
        --warning: rgba(51, 2, 53, 0.322);
        --danger: rgba(3, 1, 70, 0.322);
        --light: rgba(82, 5, 82, 0.322);
        --dark: rgba(102, 47, 102, 0.322);
        --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        --card-bg: rgba(255, 255, 255, 0.15);
        --card-border: rgba(255, 255, 255, 0.2);
      }

      body {
        background: var(--gradient);
        min-height: 100vh;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        overflow-x: hidden;
      }

      /* Background animation */
      .bg-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .bg-animation div {
        position: absolute;
        width: 60px;
        height: 60px;
        /* background: rgba(255, 255, 255, 0.1); */
        background: rgba(10, 6, 207, 0.322);
        border-radius: 50%;
        animation: float 15s infinite linear;
      }

      .bg-animation div:nth-child(1) {
        top: 20%;
        left: 20%;
        animation-delay: 0s;
      }

      .bg-animation div:nth-child(2) {
        top: 60%;
        left: 80%;
        animation-delay: 2s;
      }

      .bg-animation div:nth-child(3) {
        top: 40%;
        left: 40%;
        animation-delay: 4s;
      }

      .bg-animation div:nth-child(4) {
        top: 70%;
        left: 30%;
        animation-delay: 6s;
      }

      .bg-animation div:nth-child(5) {
        top: 30%;
        left: 70%;
        animation-delay: 8s;
      }

      @keyframes float {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-1000px) rotate(720deg);
          opacity: 0;
        }
      }

      header {
        width: 100%;
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        position: fixed;
        top: 0;
        z-index: 10;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo i {
        font-size: 1.8rem;
        color: var(--accent);
      }

      header h1 {
        font-size: 1.6rem;
        font-weight: 600;
        letter-spacing: 1px;
      }

      .user-controls {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .menu-icon {
        font-size: 1.8rem;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .menu-icon span {
        height: 3px;
        width: 25px;
        background: white;
        border-radius: 5px;
        transition: 0.3s;
      }

      .menu-icon.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }

      .menu-icon.active span:nth-child(2) {
        opacity: 0;
      }

      .menu-icon.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -6px);
      }

      nav {
        position: absolute;
        top: 70px;
        right: 40px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(15px);
        border-radius: 15px;
        display: none;
        flex-direction: column;
        width: 250px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--card-border);
      }

      nav.active {
        display: flex;
        animation: fadeIn 0.3s ease;
      }

      nav a {
        padding: 15px 20px;
        color: white;
        text-decoration: none;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      nav a:last-child {
        border-bottom: none;
      }

      nav a:hover {
        background: rgba(255, 255, 255, 0.2);
        padding-left: 25px;
      }

      nav a i {
        width: 20px;
        text-align: center;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .content {
        margin-top: 120px;
        text-align: center;
        max-width: 1200px;
        width: 90%;
        padding: 0 20px;
      }

      .welcome-section {
        margin-bottom: 40px;
      }

      .welcome-section h2 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .welcome-section p {
        font-size: 1.2rem;
        line-height: 1.6;
        max-width: 700px;
        margin: 0 auto;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 40px;
      }

      .card {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--card-border);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      }

      .card i {
        font-size: 2.5rem;
        margin-bottom: 15px;
        color: var(--light);
      }

      .card h3 {
        margin-bottom: 10px;
        font-weight: 500;
      }

      .card p {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .profile-card {
        grid-column: span 2;
        display: flex;
        align-items: center;
        text-align: left;
        padding: 30px;
      }

      .profile-image {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #fff;
        margin-right: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .profile-info h3 {
        font-size: 1.5rem;
        margin-bottom: 5px;
      }

      .profile-info p {
        margin-bottom: 10px;
        opacity: 0.9;
      }

      .profile-stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
      }

      .stat {
        text-align: center;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 600;
      }

      .stat-label {
        font-size: 0.8rem;
        opacity: 0.8;
      }

      .quick-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .action-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 50px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        font-weight: 500;
      }

      .action-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .action-btn.primary {
        background: var(--accent);
      }

      .action-btn.primary:hover {
        background: #7ba87b;
      }

      /* Notes Section */
      .notes-section {
        margin-top: 60px;
        text-align: left;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-header h2 {
        font-size: 1.8rem;
        font-weight: 600;
      }

      .notes-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .note-card {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--card-border);
        transition: transform 0.3s;
        position: relative;
      }

      .note-card:hover {
        transform: translateY(-5px);
      }

      .note-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
      }

      .note-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 5px;
      }

      .note-date {
        font-size: 0.8rem;
        opacity: 0.7;
      }

      .note-content {
        font-size: 0.9rem;
        line-height: 1.5;
        margin-bottom: 15px;
        max-height: 100px;
        overflow: hidden;
      }

      .note-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .note-btn {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 0.9rem;
        opacity: 0.7;
        transition: opacity 0.3s;
      }

      .note-btn:hover {
        opacity: 1;
      }

      .add-note-btn {
        background: var(--accent);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        font-weight: 500;
      }

      .add-note-btn:hover {
        background: #7ba87b;
        transform: translateY(-2px);
      }

      /* Note Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 100;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: var(--card-bg);
        backdrop-filter: blur(15px);
        border-radius: 15px;
        width: 90%;
        max-width: 600px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid var(--card-border);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
      }

      .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .form-control {
        width: 100%;
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--accent);
      }

      textarea.form-control {
        min-height: 150px;
        resize: vertical;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 20px;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
      }

      .btn-primary:hover {
        background: #7ba87b;
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .footer {
        margin-top: 60px;
        padding: 20px;
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        width: 100%;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .ai-header {
        padding: 15px 20px;
        background: rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .ai-header h3 {
        font-size: 1.1rem;
        font-weight: 600;
      }

      .ai-header i {
        color: var(--accent);
      }

      .ai-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .message {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 15px;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .user-message {
        align-self: flex-end;
        background: var(--accent);
        border-bottom-right-radius: 5px;
      }

      .ai-message {
        align-self: flex-start;
        background: rgba(255, 255, 255, 0.1);
        border-bottom-left-radius: 5px;
      }

      .ai-input {
        padding: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        gap: 10px;
      }

      .ai-input input {
        flex: 1;
        padding: 10px 15px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 0.9rem;
      }

      .ai-input input:focus {
        outline: none;
        border-color: var(--accent);
      }

      .ai-send {
        background: var(--accent);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .ai-send:hover {
        background: #7ba87b;
        transform: scale(1.05);
      }

      .typing-indicator {
        display: none;
        align-self: flex-start;
        background: rgba(255, 255, 255, 0.1);
        padding: 10px 15px;
        border-radius: 15px;
        border-bottom-left-radius: 5px;
        font-size: 0.9rem;
      }

      .typing-indicator.active {
        display: block;
      }

      .typing-dots {
        display: inline-block;
      }

      .typing-dots span {
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: white;
        margin: 0 2px;
        animation: typing 1.4s infinite ease-in-out;
      }

      .typing-dots span:nth-child(1) {
        animation-delay: 0s;
      }
      .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-5px);
        }
      }

      /* Responsive styles */
      @media (max-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr;
        }

        .profile-card {
          grid-column: span 1;
          flex-direction: column;
          text-align: center;
        }

        .profile-image {
          margin-right: 0;
          margin-bottom: 20px;
        }

        .profile-stats {
          justify-content: center;
        }

        header {
          padding: 15px 20px;
        }

        nav {
          right: 20px;
          width: 220px;
        }

        .welcome-section h2 {
          font-size: 2rem;
        }

        .welcome-section p {
          font-size: 1rem;
        }

        .notes-container {
          grid-template-columns: 1fr;
        }

        .ai-chatbox {
          width: 300px;
          height: 400px;
          right: -20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Background animation -->
    <div class="bg-animation">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>

    <header>
      <div class="logo">
        <i class="fa fa-graduation-cap"></i>
        <h1>EduNexa</h1>
      </div>

        <div class="menu-icon" onclick="toggleMenu()">
          <span></span><span></span><span></span>
        </div> 
      </div>

      <nav id="menu">
        <a href="/attach-image"
          ><i class="fa fa-camera"></i> Attach Profile Image</a>
        <a href="create-profile"><i class="fa fa-edit"></i> Update Profile</a>
        <a href="/varsities"
          ><i class="fa fa-university"></i> Apply for Varsities</a
        >
        <a href="/colleges"><i class="fa fa-school"></i> Apply for Colleges</a>
        <a href="/bursaries"
          ><i class="fa fa-hand-holding-usd"></i> Apply for Bursary</a>
        <a href="/documents"><i class="fa fa-file-alt"></i> My Documents</a>
        <a onclick="logoutFun()" style="color: #ffeb3b"
          ><i class="fa fa-sign-out-alt"></i> Logout</a>
      </nav>
    </header>

    <div class="content">
      <div class="welcome-section">
        <h2>Welcome, <span id="full_names">User</span> üëãüèΩ</h2>
        <p>
          We're excited to have you at EduNexa ‚Äî your gateway to academic
          success! Manage your applications, profile, and bursary submissions
          all in one place.
        </p>
      </div>

      <div class="dashboard">
        <div class="card profile-card">
          <img id="profileImagePic"
            src=""
            alt="Profile Image"
            class="profile-image"/>

          <div class="profile-info">
            <h3 id="display-name">User</h3>

            <p id="userAddress"><i class="fa fa-map-marker-alt"></i> Your Location </p>
            <div class="profile-stats">

              <!-- <div class="stat">
                <div class="stat-value">85%</div>
                <div class="stat-label">Profile Complete</div>
              </div> -->

            </div>
          </div>
        </div>

        <div class="card">
          <i class="fa fa-file-invoice-dollar"></i>
          <h3>Bursary Opportunities</h3>
          <p>Find and apply for financial aid</p>
        </div>

        <div class="card">
          <i class="fa fa-calendar-check"></i>
          <h3>Upcoming Deadlines</h3>
          <p>Never miss an important date</p>
        </div>


        <div class="card">
          <i class="fa fa-users"></i>
          <h3>Student Community</h3>
          <p>Connect with other students</p>
        </div>
      </div>

      <div class="quick-actions">
        <button class="action-btn">
          <i class="fa fa-download"></i> Download Documents 
        </button>
      </div>

      <!-- Notes Section -->
      <div class="notes-section">
        <div class="section-header">
          <h2><i class="fa fa-sticky-note"></i> My Notes</h2>
          <button class="add-note-btn" id="addNoteBtn">
            <i class="fa fa-plus"></i> Add New Note
          </button>
        </div>
        <div class="notes-container" id="notesContainer">
          <!-- Notes will be dynamically added here -->
        </div>
      </div>
    </div>

    <!-- Note Modal -->
    <div class="modal" id="noteModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="modalTitle">Add New Note</h3>
          <button class="close-btn" id="closeModal">&times;</button>
        </div>
        <form id="noteForm">
          <input type="hidden" id="noteId" />
          <div class="form-group">
            <label class="form-label" for="noteTitle">Title</label>
            <input
              type="text"
              class="form-control"
              id="noteTitle"
              placeholder="Enter note title"
              required/>
          </div>
          <div class="form-group">
            <label class="form-label" for="noteContent">Content</label>
            <textarea
              class="form-control"
              id="noteContent"
              placeholder="Write your note here..."
              required
            ></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancelNote">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Save Note</button>
          </div>
        </form>
      </div>
    </div>

    <div class="footer">
      <p>¬© 2025 EduNexa | Empowering Future Leaders Through Education</p>
    </div>

    <script>
      // Menu functionality
      function toggleMenu() {
        const menu = document.getElementById("menu");
        const menuIcon = document.querySelector(".menu-icon");

        menu.classList.toggle("active");
        menuIcon.classList.toggle("active");
      }

      // Close menu when clicking outside
      document.addEventListener("click", function (event) {
        const menu = document.getElementById("menu");
        const menuIcon = document.querySelector(".menu-icon");

        if (!menu.contains(event.target) && !menuIcon.contains(event.target)) {
          menu.classList.remove("active");
          menuIcon.classList.remove("active");
        }
      });

      // Simulate dynamic content loading
      document.addEventListener("DOMContentLoaded", function () {
        // In a real application, you would fetch this data from an API
        setTimeout(() => {
          document.getElementById("username").textContent = "Alex Johnson";
          document.getElementById("display-name").textContent = "Alex Johnson";
        }, 500);

        // Load sample notes
        loadSampleNotes();
      });

      // Add click handlers for dashboard cards
      document.querySelectorAll(".card").forEach((card) => {
        card.addEventListener("click", function () {
          // In a real application, this would navigate to the appropriate page
          alert(`You clicked on: ${this.querySelector("h3").textContent}`);
        });
      });

      // Notes functionality
      const noteModal = document.getElementById("noteModal");
      const addNoteBtn = document.getElementById("addNoteBtn");
      const closeModal = document.getElementById("closeModal");
      const cancelNote = document.getElementById("cancelNote");
      const noteForm = document.getElementById("noteForm");
      const notesContainer = document.getElementById("notesContainer");
      const modalTitle = document.getElementById("modalTitle");
      const noteIdInput = document.getElementById("noteId");
      const noteTitleInput = document.getElementById("noteTitle");
      const noteContentInput = document.getElementById("noteContent");

      let notes = [];
      let editingNoteId = null;

      // Sample notes data


      function loadSampleNotes() {

        
        // const data = {};
        fetch(`/notes/${localStorage.getItem("username")}`)
        .then (res =>{
          if(res.ok){ 
            console.log("Notes fetched successfully");
            return res.json();
           }
          else console.log("Failed to fetch notes");

        })
        .then (data => {
            notes = data // Retrieved the data thats coming from the db 
            console.log(data);
            console.log(notes);
        })
       

        const sampleNotes = [
          {
            id: 1,
            title: "University Application Deadlines",
            content:
              "UCT: 30 September\nWits: 15 October\nStellenbosch: 31 October",
            date: "2025-03-15",
          },
          {
            id: 2,
            title: "Bursary Requirements",
            content:
              "Need to submit certified ID copy, academic transcripts, and motivation letter by next week.",
            date: "2025-03-12",
          },
          {
            id: 3,
            title: "Study Plan",
            content:
              "Focus on Mathematics and Physics for the upcoming exams. Practice past papers daily.",
            date: "2025-03-10",
          },
        ];

        // notes = sampleNotes;
        renderNotes();
      }

      // Render notes to the UI
      function renderNotes() {

        fetch("/notes/malatji@gmail.com")
        .then (res =>{
          if(res.ok){ 
            console.log("Notes fetched successfully");
            return res.json();
           }
          else console.log("Failed to fetch notes");

        })
        .then (data => {
            notes = data // Retrieved the data thats coming from the db 
            console.log(data);
            console.log(notes);
        })

        notesContainer.innerHTML = "";

        if (notes.length === 0) {
          notesContainer.innerHTML =
            '<p>No notes yet. Click "Add New Note" to create your first note.</p>';
          return;
        }

        notes.forEach((note) => {
          const noteCard = document.createElement("div");
          noteCard.className = "note-card";
          noteCard.innerHTML = `
          <div class="note-header">
            <div>
              <div class="note-title">${note.title}</div>
              <div class="note-date">${formatDate(note.created_at)}</div>
            </div>
          </div>
          <div class="note-content">${note.content}</div>
          <div class="note-actions">
            <button class="note-btn edit-note" data-id="${note.id}">
              <i class="fa fa-edit"></i> Edit
            </button>
            <button class="note-btn delete-note" data-id="${note.id}">
              <i class="fa fa-trash"></i> Delete
            </button>
          </div>
        `;
          notesContainer.appendChild(noteCard);
        });

        // Add event listeners to note buttons
        document.querySelectorAll(".edit-note").forEach((btn) => {
          btn.addEventListener("click", function () {
            const id = parseInt(this.getAttribute("data-id"));
            editNote(id);
          });
        });

        document.querySelectorAll(".delete-note").forEach((btn) => {
          btn.addEventListener("click", function () {
            const id = parseInt(this.getAttribute("data-id"));
            deleteNote(id);
          });
        });
      }

      // Format date for display
      function formatDate(dateString) {
        const options = { year: "numeric", month: "short", day: "numeric" };
        return new Date(dateString).toLocaleDateString("en-US", options);
      }

      // Open modal for adding a new note
      addNoteBtn.addEventListener("click", function () {
        modalTitle.textContent = "Add New Note";
        noteIdInput.value = "";
        noteTitleInput.value = "";
        noteContentInput.value = "";
        noteModal.classList.add("active");
        editingNoteId = null;
      });

      // Close modal
      function closeNoteModal() {
        noteModal.classList.remove("active");
      }

      closeModal.addEventListener("click", closeNoteModal);
      cancelNote.addEventListener("click", closeNoteModal);

      // Handle form submission
      noteForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const title = noteTitleInput.value.trim();
        const content = noteContentInput.value.trim();

        if (!title || !content) {
          alert("Please fill in both title and content");
          return;
        }

        if (editingNoteId) {
          // Update existing note
          const noteIndex = notes.findIndex(
            (note) => note.id === editingNoteId
          );
          if (noteIndex !== -1) {
            notes[noteIndex].title = title;
            notes[noteIndex].content = content;
            notes[noteIndex].created_at = new Date().toISOString().split("T")[0];
          }
        } else {
          // Add new note
          const newNote = {
            id: notes.length > 0 ? Math.max(...notes.map((n) => n.id)) + 1 : 1,
            title,
            content,
            created_at: new Date().toISOString().split("T")[0],
          };
          fetch("/notes", {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              username: localStorage.getItem('username'), 
              title: title, 
              content: content
            })
          }) // Sends/Collect data to/from the db
          .then(res => {
              if(!res.ok){ alert("Failed to add note in the database X") }  // Check if there was a positive response from the db
              else { alert("Note added successfully !") }
          });

          notes.push(newNote);
        }

        renderNotes();
        closeNoteModal();
      });

      // Edit note
      function editNote(id) {
        const note = notes.find((note) => note.id === id);
        if (note) {
          modalTitle.textContent = "Edit Note";
          noteIdInput.value = note.id;
          noteTitleInput.value = note.title;
          noteContentInput.value = note.content;
          noteModal.classList.add("active");
          editingNoteId = id;
        }
      }

      // Delete note
      function deleteNote(id) {
        if (confirm("Are you sure you want to delete this note?")) {
          notes = notes.filter((note) => note.id !== id);
          renderNotes();
        }
      }

      // AI Assistant functionality
      const aiToggle = document.getElementById("aiToggle");
      const aiChatbox = document.getElementById("aiChatbox");
      const aiMessages = document.getElementById("aiMessages");
      const aiInput = document.getElementById("aiInput");
      const aiSend = document.getElementById("aiSend");
      const typingIndicator = document.getElementById("typingIndicator");

      // Toggle AI chatbox
      aiToggle.addEventListener("click", function () {
        aiChatbox.classList.toggle("active");
        aiToggle.classList.toggle("active");
      });

      // Send message function
      function sendMessage() {
        const message = aiInput.value.trim();
        if (!message) return;

        // Add user message to chat
        addMessage(message, "user");
        aiInput.value = "";

        // Show typing indicator
        typingIndicator.classList.add("active");

        // Simulate AI response after a delay
        setTimeout(() => {
          typingIndicator.classList.remove("active");
          const response = getAIResponse(message);
          addMessage(response, "ai");

          // Scroll to bottom
          aiMessages.scrollTop = aiMessages.scrollHeight;
        }, 1500);
      }

      // Add message to chat
      function addMessage(text, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}-message`;
        messageDiv.textContent = text;
        aiMessages.appendChild(messageDiv);

        // Scroll to bottom
        aiMessages.scrollTop = aiMessages.scrollHeight;
      }

      // Get AI response based on user input
      function getAIResponse(message) {
        const lowerMessage = message.toLowerCase();

        // Predefined responses based on keywords
        if (
          lowerMessage.includes("application") ||
          lowerMessage.includes("apply")
        ) {
          return "You can apply to universities and TVET colleges through the 'Apply for Varsities' or 'Apply for TVETs' sections. Make sure you have all your documents ready before starting your application.";
        } else if (
          lowerMessage.includes("bursary") ||
          lowerMessage.includes("funding")
        ) {
          return "EduNexa helps you find and apply for bursaries. Check the 'Bursary Opportunities' section to see available funding options. You'll need your academic records and financial information.";
        } else if (
          lowerMessage.includes("document") ||
          lowerMessage.includes("upload")
        ) {
          return "You can upload your documents in the 'My Documents' section. We accept PDF files for ID copies, academic transcripts, and other supporting documents.";
        } else if (
          lowerMessage.includes("deadline") ||
          lowerMessage.includes("due date")
        ) {
          return "Application deadlines vary by institution. Check the 'Upcoming Deadlines' section for specific dates. Most universities have deadlines between August and October.";
        } else if (
          lowerMessage.includes("profile") ||
          lowerMessage.includes("account")
        ) {
          return "You can update your personal information, profile picture, and preferences in the 'Edit Profile' section. Keeping your profile complete helps us match you with better opportunities.";
        } else if (
          lowerMessage.includes("help") ||
          lowerMessage.includes("support")
        ) {
          return "For technical support, visit the 'Support' section. Our team is available to help with any issues you encounter while using EduNexa.";
        } else if (
          lowerMessage.includes("note") ||
          lowerMessage.includes("reminder")
        ) {
          return "You can create and manage personal notes in the 'My Notes' section. This is great for keeping track of application details, deadlines, or study plans.";
        } else if (
          lowerMessage.includes("hello") ||
          lowerMessage.includes("hi")
        ) {
          return "Hello! I'm here to help you navigate EduNexa. Feel free to ask me about applications, bursaries, documents, or any other features!";
        } else {
          return "I'm here to help with EduNexa-related questions. You can ask me about applications, bursaries, documents, deadlines, or how to use different features of the platform.";
        }
      }

      // Event listeners for AI assistant
      aiSend.addEventListener("click", sendMessage);
      aiInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          sendMessage();
        }
      });

      // Close AI chat when clicking outside
      document.addEventListener("click", function (event) {
        if (
          !aiChatbox.contains(event.target) &&
          !aiToggle.contains(event.target) &&
          aiChatbox.classList.contains("active")
        ) {
          aiChatbox.classList.remove("active");
          aiToggle.classList.remove("active");
        }
      });

      function setProfilePic () {
        fetch("/getAllImages")
        .then(res => res.json())
        .then(files => {
            const results = files.filter(f => f.includes(localStorage.getItem("username")))
            console.log(files);
            document.getElementById("profileImagePic").src = "assets/images/" + results[0];
           
        });
      };


      window.onload = function () {
        document.getElementById("full_names").innerHTML =
          localStorage.getItem("full_names");

        document.getElementById("display-name").innerHTML =
          localStorage.getItem("full_names");
        
        document.getElementById("userAddress").innerHTML = 
         '<i class="fa fa-map-marker-alt"></i> '+ localStorage.getItem("address"); 
         console.log(localStorage.getItem("address"));

        setProfilePic();
        renderNotes();
      };

      function logoutFun(){
        localStorage.clear();   
        window.location.href = "/"; // Takes the user back to the home page 
        
      }

    </script>
  </body>
</html>
